<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#23469D">
  <title>Personeel Login</title>
  <link rel="stylesheet" href="styles.css?v=2" />
  <link rel="stylesheet" href="/assets/css/header.css?v=1">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/fonts.css?v=12">
  <style>
    body{font-family:'Blender','Quicksand',sans-serif;background:#23469D;min-height:100vh;margin:0;overflow:hidden}
    .staff-gate{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:40px 20px}
    .staff-card{max-width:420px;width:100%;background:rgba(255,255,255,0.95);backdrop-filter:blur(20px);border-radius:20px;box-shadow:0 20px 50px rgba(0,0,0,0.3);padding:40px;border:none}
    .staff-card h1{font-size:24px;margin-bottom:10px;color:#333;font-weight:600}
    .staff-card p{color:#666;margin-bottom:24px;font-size:16px}
    .pin-container{display:flex;gap:10px;justify-content:center;margin-bottom:20px;margin-top:-6px}
    .pin-input{width:46px;height:46px;border:2px solid #e5e7eb;border-radius:10px;text-align:center;font-size:20px;font-weight:700;color:#333;background:#fff;transition:border-color .3s ease, box-shadow .3s ease}
    .pin-input:focus{outline:none;border-color:#2954B3;box-shadow:0 0 0 3px rgba(41,84,179,0.12)}
    .pin-input.filled{border-color:#2954B3;background:#f8fafc}
    .staff-card button{width:100%;background:linear-gradient(135deg,#2954B3 0%,#1e3a8a 100%);color:#fff;border:0;border-radius:10px;padding:14px 16px;font-weight:700;cursor:pointer;transition:transform .2s ease, box-shadow .2s ease}
    .staff-card button:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(41,84,179,0.3)}
    .staff-card button:active{transform:none}
    .staff-error{color:#ef4444;min-height:18px;margin-bottom:8px;text-align:center}
    .back-link{color:#666;text-decoration:none;font-size:14px;transition:color .3s ease;margin-top:20px;display:inline-block}
    .back-link:hover{color:#2954B3}
  </style>
<link rel="icon" type="image/webp" href="/assets/images/vitalora logo.webp">
<link rel="shortcut icon" type="image/webp" href="/assets/images/vitalora logo.webp">
</head>
<body>

  <main class="staff-gate">
    <div class="staff-card">
      <h1>Personeel</h1>
      <p>Log in om het interne dashboard te openen.</p>
      <div id="err" class="staff-error" role="alert"></div>
      <form id="staff-login" autocomplete="off" style="display:flex;flex-direction:column;gap:16px;margin-top:8px">
        <div class="pin-container" id="pin-container" role="group" aria-label="Toegangscode">
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" autocomplete="one-time-code" aria-label="Eerste cijfer" />
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" aria-label="Tweede cijfer" />
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" aria-label="Derde cijfer" />
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" aria-label="Vierde cijfer" />
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" aria-label="Vijfde cijfer" />
          <input class="pin-input" type="password" inputmode="numeric" maxlength="1" aria-label="Zesde cijfer" />
        </div>
        <button type="submit" id="enter">Inloggen</button>
      </form>
      <a href="/" class="back-link">‚Üê Terug naar homepage</a>
    </div>
  </main>

  <script>
    (function(){
      const form = document.getElementById('staff-login');
      const errorDiv = document.getElementById('err');
      form.addEventListener('submit', async function(ev){
        ev.preventDefault();
        errorDiv.textContent='';
        const inputs = Array.from(document.querySelectorAll('.pin-input'));
        const code = inputs.map(inp => inp.value.replace(/\D/g,'')).join('');
        if(code.length !== inputs.length){
          errorDiv.textContent = 'Vul alle cijfers in.';
          const firstEmpty = inputs.find(inp => !inp.value);
          (firstEmpty || inputs[0]).focus();
          return;
        }
        try{
          const resp = await fetch('/api/staff/login',{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            credentials:'same-origin',
            body: JSON.stringify({ code })
          });
          const data = await resp.json().catch(()=>({}));
          if(!resp.ok){ errorDiv.textContent = data?.error || 'Inloggen mislukt.'; return; }
          window.location.href = '/personeel-dashboard';
        }catch(e){ errorDiv.textContent='Netwerkfout. Probeer opnieuw.'; }
      });

      const pinInputs = Array.from(document.querySelectorAll('.pin-input'));
      if (pinInputs.length) {
        pinInputs[0].focus();
      }

      pinInputs.forEach((input, idx) => {
        input.addEventListener('input', (e) => {
          const value = e.target.value.replace(/\D/g, '');
          e.target.value = value.slice(-1);
          if (value && idx < pinInputs.length - 1) {
            pinInputs[idx + 1].focus();
          }
        });

        input.addEventListener('keydown', (e) => {
          if (e.key === 'Backspace' && !input.value && idx > 0) {
            pinInputs[idx - 1].focus();
            pinInputs[idx - 1].value = '';
          }
          if (e.key === 'ArrowLeft' && idx > 0) {
            pinInputs[idx - 1].focus();
          }
          if (e.key === 'ArrowRight' && idx < pinInputs.length - 1) {
            pinInputs[idx + 1].focus();
          }
        });

        input.addEventListener('paste', (e) => {
          const paste = (e.clipboardData || window.clipboardData).getData('text');
          const digits = String(paste).replace(/\D/g, '').slice(0, pinInputs.length);
          if (!digits) return;
          e.preventDefault();
          digits.split('').forEach((char, offset) => {
            const target = pinInputs[idx + offset];
            if (target) target.value = char;
          });
          const nextIndex = Math.min(idx + digits.length, pinInputs.length - 1);
          pinInputs[nextIndex].focus();
        });
      });
    })();
  </script>
</body>
</html>
