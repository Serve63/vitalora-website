<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hormonaal in Balans - Cursus Overzicht</title>
    <link rel="stylesheet" href="/dashboard-styles.css">
    <link rel="stylesheet" href="/assets/css/header.css?v=12">
    <link rel="stylesheet" href="/assets/css/fonts.css?v=1">
    <link rel="stylesheet" href="/assets/css/footer.css?v=1">
</head>
<body>
    <div data-include="site-header"></div>
    <script defer src="/assets/js/header.js?v=7"></script>

    <!-- BEGIN SCOPE: djb-overview -->
    <main class="course-overview" data-course="de-juiste-balans">
      <h1 class="course-title">Hormonaal in Balans</h1>
      <p class="course-subtitle">Rust, energie en helderheid vanuit je hormonen</p>
      <section class="lessons-list" id="lessonsList"><!-- JS will inject --></section>
    </main>
    <!-- END SCOPE: djb-overview -->

    <div data-include="site-footer"></div>

    <script src="/dashboard-script.js"></script>
    <script>
        // === SCOPE: djb-lesson-loader ===
        (function(){
          const $=(s,r=document)=>r.querySelector(s);
          function base(){ return location.pathname.endsWith('/') ? location.pathname : location.pathname.replace(/[^/]+$/, ''); }
          async function getJSON(rel){ const u=base()+rel; const r=await fetch(u,{cache:'no-cache'}); if(!r.ok) throw new Error(u); return r.json(); }
          async function getHTML(rel){ const u=base()+rel; const r=await fetch(u,{cache:'no-cache'}); if(!r.ok) throw new Error(u); return r.text(); }
          function key(course){ return `academy:${course}:done`; }

          document.addEventListener('DOMContentLoaded', async ()=>{
            // OVERVIEW
            const ov = $('.course-overview');
            if(ov){
              const course = ov.getAttribute('data-course') || 'de-juiste-balans';
              try{
                const lessons = await getJSON('lessons.json');
                const done = new Set(JSON.parse(localStorage.getItem(key(course))||'[]'));
                const list = document.getElementById('lessonsList');
                list.innerHTML = lessons.map((l,i)=>`
                  <a class="lesson-item" href="lesson.html?l=${encodeURIComponent(l.slug)}">
                    <strong>${i+1}. ${l.title}</strong>${done.has(l.slug)?' <span class="badge-done">Voltooid</span>':''}
                    <div class="meta">${l.desc||''}</div>
                  </a>
                `).join('');
              }catch(e){ console.error('Overview load error', e); }
              return;
            }

            // LESSON
            const lp = document.querySelector('.lesson-page');
            if(lp){
              const course = lp.getAttribute('data-course') || 'de-juiste-balans';
              const params = new URL(location.href).searchParams;
              const slug = params.get('l'); if(!slug){ location.href='./'; return; }
              try{
                const lessons = await getJSON('lessons.json');
                const idx = lessons.findIndex(x=>x.slug===slug);
                if(idx===-1){ location.href='./'; return; }
                const l = lessons[idx];
                document.getElementById('lessonTitle').textContent = l.title;
                document.getElementById('crumbTitle').textContent = l.title;
                document.getElementById('lessonBody').innerHTML = await getHTML(l.file);

                const prev = document.getElementById('prevLesson');
                const next = document.getElementById('nextLesson');
                if(idx>0){ prev.href=`lesson.html?l=${encodeURIComponent(lessons[idx-1].slug)}`; prev.removeAttribute('aria-disabled'); }
                if(idx<lessons.length-1){ next.href=`lesson.html?l=${encodeURIComponent(lessons[idx+1].slug)}`; next.removeAttribute('aria-disabled'); }

                const k = key(course);
                const done = new Set(JSON.parse(localStorage.getItem(k)||'[]'));
                const btn = document.getElementById('markDoneBtn');
                function render(){ btn.textContent = done.has(slug)?'Voltooid âœ”':'Markeer als voltooid'; }
                btn.addEventListener('click', ()=>{ if(done.has(slug)) done.delete(slug); else done.add(slug); localStorage.setItem(k, JSON.stringify([...done])); render(); });
                render();
              }catch(e){ console.error('Lesson load error', e); }
            }
          });
        })();
    </script>
</body>
</html>
