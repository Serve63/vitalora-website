<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blog – Vitalora</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css?v=2">
  <link rel="stylesheet" href="/assets/css/header.css">
  <link rel="stylesheet" href="/assets/css/fonts.css?v=12">
  <link rel="stylesheet" href="/assets/css/footer.css?v=12">
  <style>
    body { font-family: 'Quicksand', sans-serif; background:#EDF2FB; color:#333; }
    .blog-post-container{max-width:1000px;margin:40px auto;padding:40px;background:#fff;border-radius:12px;box-shadow:0 4px 20px rgba(0,0,0,0.08)}
    .blog-post-header{margin-bottom:24px}
    .blog-post-title{font-size:42px;color:#333;margin-bottom:12px;font-weight:700;line-height:1.2;letter-spacing:-0.02em}
    .blog-post-meta{display:flex;flex-direction:column;gap:8px;color:#6b7280;font-size:15px;margin-bottom:16px;font-weight:500}
    .blog-post-meta-item{display:flex;align-items:center;gap:8px}
    .blog-post-date::before,.blog-post-read-time::before{content:"";width:16px;height:16px;background-size:contain;background-repeat:no-repeat}
    .blog-post-date::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z'/%3E%3C/svg%3E")}
    .blog-post-read-time::before{background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'/%3E%3C/svg%3E")}
    .blog-post-featured-image{width:100%;height:400px;background:#e5e7eb;border-radius:12px;margin:24px 0 32px;display:flex;align-items:center;justify-content:center;color:#6b7280;font-size:16px;font-weight:500;overflow:hidden}
    .blog-post-featured-image img{width:100%;height:100%;object-fit:cover;border-radius:12px}
    .blog-post-content{padding:0;line-height:1.8;color:#333;font-size:18px}
    .blog-post-content h1,.blog-post-content h2,.blog-post-content h3,.blog-post-content h4{color:#333;margin-top:48px;margin-bottom:20px;font-weight:700;line-height:1.3;letter-spacing:-0.01em}
    .blog-post-content h2,.blog-post-content h3,.blog-post-content h4{color:#2954B3}
    .blog-post-content p{margin-bottom:24px;font-size:18px;line-height:1.8}
    .blog-post-content blockquote{background:#2954B3;color:#fff;padding:20px 24px;margin:24px 0;border-radius:8px;border-left:none;box-shadow:0 4px 12px rgba(41,84,179,0.2);font-size:16px;line-height:1.5;font-weight:500}
    @media (max-width:768px){.blog-post-container{margin:20px auto;padding:20px}.blog-post-title{font-size:32px}.blog-post-featured-image{height:200px;margin:20px 0 24px}.blog-post-content{font-size:16px}}
  </style>
<link rel="icon" type="image/webp" href="/assets/images/vitalora logo.webp">
<link rel="shortcut icon" type="image/webp" href="/assets/images/vitalora logo.webp">
</head>
<body>
  <script defer src="/assets/js/header.js?v=5"></script>
  <div data-include="site-header"></div>
  
  <main class="main-content">
    <div class="blog-post-container">
      <div class="blog-post-header">
        <div class="blog-post-meta">
          <span class="blog-post-meta-item blog-post-date" id="post-date">-</span>
          <span class="blog-post-meta-item blog-post-read-time" id="post-read-time">-</span>
        </div>
        <h1 id="post-title" class="blog-post-title">Laden...</h1>
      </div>
      <div class="blog-post-featured-image" id="featured-image">Afbeelding placeholder</div>
      <div class="blog-post-content" id="post-content">Nog invullen.</div>
    </div>
  </main>

  <script>
    console.log('=== POST TEMPLATE SCRIPT START ===');
    
    (async function(){
      const params = new URLSearchParams(location.search);
      // Haal slug uit querystring of uit de path (pretty URL: /:slug)
      let slug = params.get('slug');
      console.log('Slug from params:', slug);
      
      if (!slug) {
        const path = (location.pathname || '/').replace(/\/$/, '');
        // Neem laatste segment tenzij het leeg of 'post.html' is
        const segments = path.split('/').filter(Boolean);
        const last = segments[segments.length - 1] || '';
        slug = (last && last !== 'post.html') ? last : '';
        console.log('Slug from path:', slug);
      }

      const titleEl = document.getElementById('post-title');
      const metaEl = document.getElementById('post-meta');
      const contentEl = document.getElementById('post-content');

      if (!slug) {
        titleEl.textContent = 'Blog post niet gevonden';
        contentEl.innerHTML = '<p>Geen slug opgegeven.</p>';
        return;
      }

      // Toon basis info
      titleEl.textContent = slug.replace(/-/g,' ').replace(/\b\w/g, c => c.toUpperCase());
      if (metaEl) { metaEl.textContent = '/' + slug; }

      // 1) Probeer uit localStorage (van jouw CRM)
      let post = null;
      try {
        const posts = JSON.parse(localStorage.getItem('vitalora_blog_posts') || '[]');
        console.log('Posts from localStorage:', posts);
        post = posts.find(p => (p.slug === slug));
        console.log('Found post:', post);
      } catch (e) {
        console.log('Error loading from localStorage:', e);
      }

      // 2) Fallback: probeer statische HTML te halen en te parsen
      async function fetchStatic(sl){
        try {
          const res = await fetch('/' + encodeURIComponent(sl) + '.html', { credentials: 'same-origin' });
          if (!res.ok) return null;
          const html = await res.text();
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');
          const h1 = doc.querySelector('.blog-title, h1');
          const content = doc.querySelector('.blog-content, article, main');
          const dateEl = doc.querySelector('.blog-date');
          const parsed = {
            title: h1 ? h1.textContent.trim() : slug.replace(/-/g,' '),
            content: content ? content.innerHTML : '<p>Geen inhoud gevonden.</p>',
            publishedDate: dateEl ? dateEl.textContent.trim() : ''
          };
          return parsed;
        } catch (e) {
          return null;
        }
      }

      if (!post) {
        console.log('No post found in localStorage, trying static fallback...');
        post = await fetchStatic(slug);
        console.log('Static fallback result:', post);
      }

      if (!post) {
        console.log('No post found anywhere, showing empty state');
        // Niets gevonden in storage en geen statische fallback: toon nette lege staat
        titleEl.textContent = slug.replace(/-/g,' ').replace(/\b\w/g, c => c.toUpperCase());
        document.getElementById('post-date').textContent = '-';
        document.getElementById('post-read-time').textContent = '-';
        contentEl.innerHTML = '<p>Deze blog post is nog leeg.</p>';
        return;
      }

      // Toon post data
      console.log('Rendering post data:', post);
      document.title = (post.metaTitle || post.title || titleEl.textContent) + ' - Vitalora';
      titleEl.textContent = post.title || titleEl.textContent;
      console.log('Title set to:', titleEl.textContent);
      
      if (post.publishedDate) {
        if (metaEl) { metaEl.textContent = '/' + slug + ' · ' + post.publishedDate + (post.readTime ? (' · ' + post.readTime + ' min') : ''); }
        document.getElementById('post-date').textContent = post.publishedDate;
        document.getElementById('post-read-time').textContent = (post.readTime || 5) + ' min';
        console.log('Meta data set');
      }
      
      if (post.content && post.content.trim()) {
        console.log('Setting content from post.content');
        contentEl.innerHTML = post.content;
      } else if (post.text || post.excerpt) {
        console.log('Setting content from post.text/excerpt');
        contentEl.textContent = (post.text || post.excerpt);
      } else {
        console.log('No content found, showing empty state');
        contentEl.innerHTML = '<p>Deze blog post is nog leeg.</p>';
      }
      
      console.log('Content element innerHTML:', contentEl.innerHTML);

      // Featured image handling
      try {
        const featuredWrap = document.getElementById('featured-image');
        if (featuredWrap) {
          if (post.featuredImage && typeof post.featuredImage === 'string' && post.featuredImage.trim() !== '') {
            const img = document.createElement('img');
            img.src = post.featuredImage;
            img.alt = post.title || slug;
            featuredWrap.innerHTML = '';
            featuredWrap.appendChild(img);
          } else {
            // Fallback: try first image from content if present
            const tmp = document.createElement('div');
            tmp.innerHTML = post.content || '';
            const firstImg = tmp.querySelector('img');
            if (firstImg && firstImg.src) {
              const img = document.createElement('img');
              img.src = firstImg.src;
              img.alt = post.title || slug;
              featuredWrap.innerHTML = '';
              featuredWrap.appendChild(img);
            }
          }
        }
      } catch (e) {
        console.log('Error rendering featured image:', e);
      }

      // Zet canonical naar pretty URL
      (function setCanonical(){
        var canonical = document.querySelector('link[rel="canonical"]');
        if(!canonical){
          canonical = document.createElement('link');
          canonical.setAttribute('rel','canonical');
          document.head.appendChild(canonical);
        }
        canonical.setAttribute('href', location.origin + '/' + encodeURIComponent(slug));
      })();

      console.log('=== POST TEMPLATE SCRIPT END ===');
    })();
  </script>
</body>
</html>

