<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bedankt – Vitalora</title>
  <meta name="theme-color" content="#2954B4">
  <link rel="icon" type="image/webp" href="/assets/images/vitalora logo.webp">
  <link rel="shortcut icon" type="image/webp" href="/assets/images/vitalora logo.webp">
  <link rel="stylesheet" href="thanks-styles.css" />
  <link rel="stylesheet" href="/assets/css/header.css?v=20">
  <link rel="stylesheet" href="/assets/css/fonts.css?v=6">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="header-inner">
      <a class="logo" href="/">
        <span class="logo-text">Vitalora.nl</span>
      </a>
      
      <div class="header-buttons">
        <a class="btn login-btn" href="/login">Inloggen</a>
      </div>
    </div>
  </header>

  <div class="container">
    <section class="hero">
      <div class="photo">
        <img src="/assets/images/danielle slegers bedankt.jpeg" alt="Danielle loopt buiten" />
      </div>
      <div class="text">
        <div class="pill">Heel veel succes!</div>
        <h1 class="title">Je hebt de juiste<br>keuze gemaakt.</h1>
        <div class="copy">
          <p>Je lichaam gaat weer doen wat het hoort te doen: energie geven, helder denken, beter herstellen.</p>
          <p>Blijf erbij. Geef aandacht aan je proces. Wat je nu in gang hebt gezet, ga je voelen – en terugzien.</p>
          <p>Ik wens je heel veel succes en plezier in dit nieuwe avontuur.</p>
          <p class="signature">Liefs, Daniëlle</p>
        </div>
      </div>
    </section>

    <h2 class="section-title">Wat nu?</h2>
    <section class="steps">
      <div>
        <div class="step">
          <div class="bullet">1</div>
          <div>
            <h4>Check je e‑mail</h4>
            <p>Binnen enkele minuten ontvang je een bevestigingsmail met je toegangsgegevens en verdere instructies.</p>
          </div>
        </div>
        <div class="step">
          <div class="bullet">2</div>
          <div>
            <h4>Maak je account aan</h4>
            <p>Volg de link in je e‑mail om in te loggen of ga naar de homepage en log daar in</p>
          </div>
        </div>
        <div class="step">
          <div class="bullet">3</div>
          <div>
            <h4>Start je reis</h4>
            <p>Begin met je gepersonaliseerde programma en ontdek alle tools en begeleiding die voor je klaarstaan.</p>
          </div>
        </div>
      </div>
      <div class="help">
        <h4>Hulp nodig?</h4>
        <p><strong>E‑mail niet ontvangen?</strong><br>Check je spam/ongewenste e‑mail map of neem contact met ons op.</p>
        <p><strong>Technische problemen?</strong><br>Stuur een e‑mail naar <a href="mailto:info@vitalora.nl">info@vitalora.nl</a>.</p>
        <p><strong>Vragen over het programma?</strong><br>Bekijk onze veelgestelde vragen of plan een gesprek in.</p>
        <button class="contact" onclick="window.location.href='mailto:info@vitalora.nl'">Contact opnemen</button>
      </div>
    </section>

    <section class="upsell">
      <div class="upsell-card">
        <div class="upsell-badge">Eenmalig aanbod</div>
        <h3>Voeg de Detox Bundel toe voor slechts €1,00</h3>
        <p>Direct toegang tot extra modules, cheatsheets en audio’s die je Clean Reset traject nog makkelijker maken. Kies hieronder om het symbolische bedrag te laten incasseren via je opgeslagen betaalmethode.</p>
        <div class="upsell-actions">
          <button id="upsell-buy" class="upsell-cta">Ja, voeg de bundel toe →</button>
          <button id="upsell-skip" type="button" class="upsell-link">Nee bedankt, ga naar de Academy</button>
        </div>
        <p id="upsell-feedback" class="upsell-feedback" role="status"></p>
      </div>
    </section>
  </div>

  <script>
    (function(){
      const upsellBtn = document.getElementById('upsell-buy');
      const skipBtn = document.getElementById('upsell-skip');
      const feedbackEl = document.getElementById('upsell-feedback');
      if(!upsellBtn) return;

      const params = new URLSearchParams(location.search);
      const cid = params.get('cid');
      const pm = (params.get('pm') || '').toLowerCase();
      const nextUrl = '/academy';

      const resolveRecurringMethod = (paymentMethod) => {
        if(!paymentMethod) return '';
        if(paymentMethod.includes('ideal') || paymentMethod.includes('bancontact')) return 'directdebit';
        if(paymentMethod.includes('directdebit') || paymentMethod.includes('sepa')) return 'directdebit';
        if(paymentMethod.includes('credit')) return 'creditcard';
        return '';
      };

      const setFeedback = (message, type = '') => {
        if (!feedbackEl) return;
        feedbackEl.textContent = message;
        feedbackEl.className = `upsell-feedback${type ? ' ' + type : ''}`;
      };

      const recurringMethod = resolveRecurringMethod(pm);

      if(!cid){
        upsellBtn.disabled = true;
        upsellBtn.textContent = 'Betaalgegevens niet gevonden';
        setFeedback('We kunnen je opgeslagen betaalmethode niet vinden. Neem contact op met support@vitalora.nl.', 'error');
        if(skipBtn){
          skipBtn.disabled = true;
          skipBtn.textContent = 'Neem contact op met support';
        }
        return;
      }

      try{
        const cleanParams = new URLSearchParams(params);
        cleanParams.delete('cid');
        cleanParams.delete('pm');
        const query = cleanParams.toString();
        const newUrl = `${location.pathname}${query ? `?${query}` : ''}${location.hash}`;
        history.replaceState({}, '', newUrl);
      }catch(_e){
        // no-op if history API not available
      }

      if(skipBtn){
        skipBtn.addEventListener('click', function(){
          window.location.href = nextUrl;
        });
      }

      upsellBtn.addEventListener('click', async function(){
        if(!confirm('Wil je de bundel direct toevoegen voor €1,00 met je opgeslagen betaalmethode?')) return;

        upsellBtn.textContent = 'Bezig...';
        upsellBtn.disabled = true;
        setFeedback('We verwerken je betaling...', '');

        try{
          const payload = { amount:'1.00', description:'Upsell Bundel', recurring: true, customerId: cid };
          if(recurringMethod) payload.recurringMethod = recurringMethod;

          const resp = await fetch('/api/create-payment', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify(payload)
          });
          const data = await resp.json();
          if(!resp.ok) throw new Error(data?.error || 'Upsell mislukt');

          if(data.checkoutUrl){
            window.location.href = data.checkoutUrl;
            return;
          }

          const status = (data.status || '').toLowerCase();
          if(['paid','authorized'].includes(status)){
            setFeedback('Gelukt! De bundel wordt meteen toegevoegd aan je account.', 'success');
            setTimeout(() => window.location.href = nextUrl, 1200);
            return;
          }

          if(['pending','open','processing'].includes(status)){
            setFeedback('Je betaling is ontvangen en wordt verwerkt. Dit rondt binnen enkele minuten af.', 'success');
            setTimeout(() => window.location.href = nextUrl, 2000);
            return;
          }

          throw new Error(`Onverwachte status: ${status || 'onbekend'}`);
        }catch(e){
          setFeedback('Kon upsell niet starten. Probeer opnieuw of neem contact op met support@vitalora.nl.', 'error');
          upsellBtn.textContent = 'Ja, voeg de bundel toe →';
          upsellBtn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
